"use strict";(self.webpackChunkwidget_client=self.webpackChunkwidget_client||[]).push([[943],{3184:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var r=n(2791);var a=n.p+"static/media/calling-icon.f060351682e26879a3e202352699c7a5.svg";var c=n.p+"static/media/disconnect.46aafdc14bd112513c14360bd76826bb.svg";var s=n.p+"static/media/mute.f48c3f07b7f65d703bc0601081f75882.svg";var i=n.p+"static/media/pause.22feff219548ef186e405f1b65d8ba1b.svg";var l=n.p+"static/media/speaker.762e155d8fac97e13bf96e4036481a1c.svg",o=n(7689),u=n(4165),d=n(5861),f=n(9439),p=n(8986);var v=n.p+"static/media/callInitial.8d91244ff53b5cec7f185e8f9980b606.svg",g=n.p+"static/media/Dial-tone-sound.93fc588217d68cfaf97a.mp3",m=n.p+"static/media/busy-tone.c6c2375f06dd54dd9d14.mp3",h=n(588),x=n(9610),b=function(){var e,t,n,a,s=(0,r.useState)("initial"),i=(0,f.Z)(s,2),l=i[0],b=i[1],j=(0,r.useState)(!1),w=(0,f.Z)(j,2),A=w[0],Z=w[1],I=(0,r.useState)(null),k=(0,f.Z)(I,2),P=k[0],S=k[1],y=(0,r.useState)(null),E=(0,f.Z)(y,2),N=E[0],T=E[1],B=(0,r.useRef)(new Audio(g)),D=(0,r.useRef)(new Audio(m)),H=(0,r.useRef)(null),R=(0,r.useRef)(null),C=(0,r.useRef)(9),_=(0,o.TH)(),M=(0,o.s0)(),G=localStorage.getItem("agentPeerId"),L=null===(e=_.state)||void 0===e?void 0:e.agentName,O=(0,r.useState)(G),U=(0,f.Z)(O,2),z=U[0],F=U[1],q=(0,r.useState)(L),J=(0,f.Z)(q,2),K=J[0],Q=J[1],V={metadata:{phone:null===_||void 0===_||null===(t=_.state)||void 0===t?void 0:t.phone,name:null===_||void 0===_||null===(n=_.state)||void 0===n?void 0:n.name,department:null===_||void 0===_||null===(a=_.state)||void 0===a?void 0:a.department}},W=function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==t){e.next=7;break}return D.current.loop=!0,D.current.play().catch((function(e){console.log("error in playing the audio ",e)})),console.log("just befor freeAgentTimer"),e.next=6,ne();case 6:return e.abrupt("return");case 7:return e.prev=7,H.current=new p.ZP({host:"0.peerjs.com",port:443,path:"/",pingInterval:5e3}),e.next=11,new Promise((function(e){H.current.on("open",(function(t){return e(t)}))}));case 11:return e.sent,!1===A&&(console.log("I am working ",B),B.current.loop=!0,B.current.play().catch((function(e){console.log("error in playing the audio ",e)}))),e.next=15,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 15:n=e.sent,X(n),r=H.current.connect(t),T(r),r.on("close",(function(){M("".concat(x.Bp.BASE_PATH,"/").concat(x.Bp.PAGES.DEPARTMENT),{state:null===_||void 0===_?void 0:_.state}),Z(!0),B.current.pause()})),a=H.current.call(t,n,V),S(a),a.on("stream",(function(e){B.current.pause(),B.current.currentTime=0,Z(!0),Y(e)})),a.on("close",(function(){console.log("User ends the call"),r.close(),B.current.pause(),Z(!1),M("".concat(x.Bp.BASE_PATH,"/").concat(x.Bp.PAGES.DEPARTMENT),{state:null===_||void 0===_?void 0:_.state})})),e.next=29;break;case 26:e.prev=26,e.t0=e.catch(7),console.error("Error initializing the call:",e.t0);case 29:case"end":return e.stop()}}),e,null,[[7,26]])})));return function(t){return e.apply(this,arguments)}}(),X=function(e){var t=new Audio;t.autoplay=!1,t.srcObject=e},Y=function(e){var t=new Audio;t.autoplay=!1,t.srcObject=e,t.play()},$=function(){try{null!==P&&(console.log("Disconnect function is triggered"),P.close(),B.current.pause(),S(null),Z(!1),null!==N&&N.send({type:"close_call"})),D.current.pause(),M("".concat(x.Bp.BASE_PATH,"/").concat(x.Bp.PAGES.DEPARTMENT),{state:null===_||void 0===_?void 0:_.state})}catch(e){console.log("Error in disconnecting the call",e)}},ee=[{status:"calling",title:"Calling",icon:v,handler:$},{status:"initial",title:"Initial",icon:c,handler:W}];(0,r.useEffect)((function(){W(z)}),[z]),(0,r.useEffect)((function(){A&&B.current.pause()}),[A]);var te=function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t,n,r,a,c,s,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.Z.getAgents(_.state.department);case 3:if(r=e.sent,console.log("getFreeAgent",r),!((a=null===r||void 0===r||null===(t=r.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.result)&&a.length>0)){e.next=15;break}return console.log("tmpAgent",a),clearInterval(R.current),console.log("clear tmpAgent",a),F(null===(c=a[0])||void 0===c?void 0:c.peerId),Q(null===(s=a[0])||void 0===s?void 0:s.username),localStorage.setItem("agentPeerId",null===(i=a[0])||void 0===i?void 0:i.peerId),D.current.pause(),e.abrupt("return",r);case 15:e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(0),console.log("error in fetching agents",e.t0),e.abrupt("return",e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("freeAgentTimer"),R.current&&clearInterval(R.current),R.current=setInterval((0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.current-=1,console.log("setInterval"),e.next=4,te();case 4:if(!(C.current<0)){e.next=8;break}return clearInterval(R.current),e.next=8,$();case 8:case"end":return e.stop()}}),e)}))),5e3);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{status:l,setStatus:b,statusList:ee,location:_,callDeclineHandler:$,agentPeerId:z,agentName:K}},j=n(184),w=function(){var e,t=(0,o.TH)();console.log("najmu",t);var n=b(),r=(n.callInitialHandler,n.callDeclineHandler),u=n.status,d=(n.setStatus,n.statusList,n.agentPeerId),f=n.agentName;return(0,j.jsxs)("div",{className:"container flex min-w-full flex-col items-center p-8",children:[(0,j.jsxs)("div",{className:"border-b-2 w-72 p-6",children:[(0,j.jsx)("h1",{className:"font-medium leading-8 text-xl",children:"undefined"!==d?"Calling to ".concat(null===(e=t.state)||void 0===e?void 0:e.department,"(").concat(f,")"):"Calling"}),(0,j.jsx)("span",{className:"text-gray-500",children:u})]}),(0,j.jsxs)("div",{className:"mt-14",children:[(0,j.jsx)("img",{src:a,alt:"Phone-icon"}),(0,j.jsxs)("div",{className:"flex justify-between mt-6",children:[(0,j.jsx)("div",{className:"cursor-pointer",onClick:function(){return r()},children:(0,j.jsx)("img",{src:c,alt:"Disconnect-icon"})}),(0,j.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,j.jsx)("div",{children:(0,j.jsx)("img",{src:l,alt:"Speaker-icon"})}),(0,j.jsx)("div",{children:(0,j.jsx)("img",{src:s,alt:"Mute-icon"})}),(0,j.jsx)("div",{children:(0,j.jsx)("img",{src:i,alt:"Pause-icon"})})]})]})]})]})}}}]);
//# sourceMappingURL=943.c0faf62f.chunk.js.map